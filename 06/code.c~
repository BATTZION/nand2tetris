#include <stdio.h>
#include <malloc.h>
#include <string.h>
#include "parser.h"
#include "hashtable.h"

char *DEST[]={"null","M","D","MD","A","AM","AD","AMD"};
char *CODE_DEST[]={"000","001","010","011","100","101","110","111"};
char *JUMP[]={"null","JGT","JEQ","JGE","JLT","JNE","JLE","JMP"};
char *CODE_JUMP[]={"000","001","010","011","100","101","110","111"};
char *COMP[]={"0","1","-1","D","A","!D","!A","-D","-A","D+1","A+1","D-1","A-1","D+A","D-A","A-D","D&A","D|A","M","!M","-M","M+1","M-1","D+M","D-M","M_D","D&M","D|M"};
char *CODE_COMP[]={"0101010","0111111","0111010","0001100","0110000","0001101","0110001","0001111","0110011","0011111","0110111","0001110","0110010","0000010","0010011","0000111","0000000","010101","1110000","1110001","1110011","1110111","1110010","1000010","1010011","1000111","1000000","1010101"};

void code_dest(char p[],char code[])
{
	int i=0;
	while(strcmp(p,*(DEST+i))!=0)
	  i++;
	strcat(code,*(CODE_DEST+i));
     
}
void code_jump(char p[],char code[])
{
	int i=0;
	while(strcmp(p,*(JUMP+i))!=0)
	  i++;
	strcat(code,*(CODE_JUMP+i));
}
void code_comp(char p[],char code[])
{
	int i=0;
	while(strcmp(p,*(COMP+i))!=0)
	  i++;
	strcat(code,*(CODE_COMP+i));

i}
void code_a_command(char source[], char code[], HashTable *list)
{
	char *temp;
	strcat(code,"0");
	if(is_number(symbol(source)))
	  strcat(code,symbol(source));
	else{
	  hash_find(list,symbol(source),&temp);
	  strcat(code,temp);
	}
	code[MAX_CODE_LEN]='\n';
	code[MAX_CODE_LEN+1]='\0';
    
}
void code_c_command(char source[], char code[])
{
	strcat(code,"111");
	code_comp((comp(source)),code);
	code_dest((dest(source)),code);
	code_jump((jump(source)),code);
	code[MAX_CODE_LEN]='\n';
	code[MAX_CODE_LEN+1]='\0';
}
